---
lab:
    title: '使用 Azure Databricks 进行分布式深度学习'
    module: '可选练习'
---

# 分布式深度学习的设置

首先，你需要使用交互式**标准**群集访问 Azure Databricks 工作区。如果没有工作区和/或所需的群集，请按照下面的说明操作。

## 创建 Azure Databricks 资源

若要使用 Azure Databricks，首先需要在 Azure 订阅中部署 Azure Databricks 工作区，然后创建将在其中运行笔记本和代码的群集。然后，可以上传数据和笔记本，以在工作区中进行试验。

### 部署 Azure Databricks 工作区

1. 在 [Azure 门户](https://portal.azure.com)中，创建新的 **Azure Databricks** 资源，并指定以下设置：
   - **订阅**：*选择要在其中部署工作区的 Azure 订阅。*
   - **资源组**：*创建新的资源组。*
   - **工作区名称**：*为工作区提供名称。*
   - **区域**：*选择你附近的位置进行部署。有关 Azure Databricks 支持的区域列表，请参阅[按区域提供的 Azure 服务](https://azure.microsoft.com/regions/services/)。*
   - **定价层**：标准

1. 等待工作区创建完毕。创建工作区需要几分钟时间。在创建工作区过程中，门户会在右侧显示“正在提交 Azure Databricks 的部署”磁贴。可能需要在仪表板上向右滚动才能看到该磁贴。另外，还会在屏幕顶部附近显示进度条。你可以查看任意一个区域以了解进度。

### 创建群集

1. 创建 Azure Databricks 工作区资源后，在门户中转到该资源，然后选择“**启动工作区**”，在新选项卡中打开 Databricks 工作区，并在出现提示时登录。

1. 在 Databricks 工作区的左侧菜单中，选择“**计算**”，然后选择“**+ 创建群集**”，添加新群集并采用以下配置：
   - **名称**： *输入唯一名称。*
   - **群集模式**：标准
   - **池**：无
   - **Databricks Runtime 版本**： *选择最新版运行时的 **ML** 版本。确保选中该版本：*
      - *CPU 和 GPU 群集均可用于此练习。CPU 的测试成本低于 GPU 的测试成本。*
      - *包括 Scala > **2.11***
      - *包括 Spark > **3.0***
   - **终止时间**：非活动时间达到 120 分钟时
   - **节点类型**：Standard_DS3_v2

1. 等待群集创建完毕，这可能需要几分钟的时间。群集将自动启动，最后群集名称旁边旋转的“*暂停*”指示符将变为绿色实心圆圈，以指示“*正在运行*”状态。

### 导入 Databricks 笔记本

1. 在 Azure Databricks 工作区的左侧命令栏中，选择“**工作区**”。然后，选择“**用户**”和 **&#9751; your_user_name**。

1. 在显示的边栏选项卡中，选择名称旁边的向下指向 V 形符号 (**v**)，然后选择“**导入**”。

1. 在“**导入笔记本**”对话框中，从以下 URL 导入笔记本存档，注意系统会创建一个与存档同名的文件夹，其中包含两个笔记本：
   - `https://github.com/MicrosoftLearning/dp-090-databricks-ml/blob/madiepev-add-modules/06%20-%20Distributed%20Deep%20Learning.dbc`

## 探索分布式深度学习

在此练习中，你将了解如何使用自动化的 MLflow 进行超参数优化。

1. 在工作区的“**05 - 超参数优化**”文件夹中，打开“**1.0 自动化的 MLflow 超参数优化**”笔记本。

1. 在左上角的下拉菜单中，选择群集，将笔记本附加到该群集。*（或者，在未附加的笔记本中运行第一个单元时，系统会提示附加群集）。*

1. 阅读笔记本中的笔记，依次运行每个代码单元。

## 清理

如果当前完成了使用 Azure Databricks，请在 Azure Databricks 工作区的“**计算**”页面上，选择你的群集，然后选择“**&#9632; 终止**”以将其关闭。否则，让它继续运行以便你在下一个练习中使用。
